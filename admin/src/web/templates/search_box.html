{% extends 'layout.html' %}
{% block title %}Búsqueda{% endblock %}
{% block head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  {{ super() }}
{% endblock %}

{% block content %}
  {% if anterior %}
    <a href="{{ anterior }}" class="button">Volver</a>
  {% else %}
    <a href="/" class="button">Volver a inicio</a>
  {% endif %}

  <a class="button is-primary is-pulled-left" href="{{ url_for(entidad + '.new') }}">Agregar</a>
  <br><br>

  <section class="search_box">
    <form method="GET" action="{{ url_for(entidad + '.search') }}">
      {{ form.hidden_tag() }}

      <!-- Iteración dinámica de campos del formulario -->
      {% for field in form if field.name != 'csrf_token' and field.type != 'SubmitField' %}
        <div class="field">
          <label class="label">{{ field.label.text }}</label>
          <div class="control">
            {{ field(class="input") }}
          </div>
        </div>
      {% endfor %}

      <!-- Botón de búsqueda -->
      <div class="field">
        <div class="control">
          {{ form.submit(class="button is-info") }}
        </div>
      </div>
    </form>
  </section>
  
  <br><br>
  {% include 'list.html' %}
  <br>

  <!-- Controles de paginación -->
  <nav class="pagination is-rounded" role="navigation" aria-label="pagination">
    <div class="pagination">
      {% if current_page > 1 %}
        <a href="{{ url_for(entidad + '.search', page=current_page - 1, per_page=per_page, **request.args) }}" class="pagination-previous">Anterior</a>
      {% endif %}

      {% for page_num in range(1, pages + 1) %}
        {% if page_num == current_page %}
          <strong>{{ page_num }}</strong>
        {% else %}
          <a href="{{ url_for(entidad + '.search', page=page_num, per_page=per_page, **request.args) }}">{{ page_num }}</a>
        {% endif %}
      {% endfor %}

      {% if current_page < pages %}
        <a href="{{ url_for(entidad + '.search', page=current_page + 1, per_page=per_page, **request.args) }}" class="pagination-next">Siguiente</a>
      {% endif %}
    </div>
  </nav>

  <p>Total: {{ total }}</p>
{% endblock %}
