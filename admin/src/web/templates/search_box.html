{% extends 'layout.html' %}
{% block title %}Búsqueda{% endblock %}
{% block head %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
  {{ super() }}
{% endblock %}

{% block content %}
  <h1 class="title is-2 has-text-centered has-text-weight-bold">
    {{ "Listado de " + entidad | default("Listado", true) }}
  </h1>

  <a href="/" class="button">Volver a inicio</a>

  <a class="button is-primary is-pulled-left" href="{{ url_for(entidad + '.new') }}">Agregar</a>
  <br><br>

  <section class="search_box">
    <form method="GET" action="{{ url_for(entidad + '.search') }}">
      {{ form.hidden_tag() }}

      <!-- Iteración dinámica de campos del formulario -->
      {% for field in form if field.name != 'csrf_token' and field.type != 'SubmitField' %}
        <div class="field">
          <label class="label">{{ field.label.text }}</label>
          <div class="control">
            {{ field(class="input") }}
          </div>
        </div>
      {% endfor %}

      <!-- Botón de búsqueda -->
      <div class="field">
        <div class="control">
          {{ form.submit(class="button is-info") }}
        </div>
      </div>
    </form>
  </section>
  
  <br><br>
  {% include 'list.html' %}
  <br>

  <!-- Controles de paginación -->
  <nav class="pagination is-centered is-rounded" role="navigation" aria-label="pagination">
    <ul class="pagination-list">
      {% if current_page > 1 %}
        <li>
          <a href="{{ url_for(entidad + '.search', page=current_page - 1, per_page=per_page, **form.data) }}" class="pagination-previous has-background-info has-text-white">Anterior</a>
        </li>
      {% endif %}
  
      {% for page_num in range(1, pages + 1) %}
        <li>
          {% if page_num == current_page %}
            <span class="pagination-link is-current">{{ page_num }}</span>
          {% else %}
            <a href="{{ url_for(entidad + '.search', page=page_num, per_page=per_page, **form.data) }}" class="pagination-link">{{ page_num }}</a>
          {% endif %}
        </li>
      {% endfor %}
  
      {% if current_page < pages %}
        <li>
          <a href="{{ url_for(entidad + '.search', page=current_page + 1, per_page=per_page, **form.data) }}" class="pagination-next has-background-info has-text-white">Siguiente</a>
        </li>
      {% endif %}
    </ul>
  </nav>
  

  <p>Total: {{ total }}</p>
{% endblock %}
